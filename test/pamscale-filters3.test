#! /bin/bash
# This script tests: pamscale pamstretch pamstretch-gen 
 # Also requires: pamvalidate pnmpsnr || \
  echo failure ${PIPESTATUS[@]} ":" $?

tmpdir=${tmpdir:-/tmp}
stretch_ppm=${tmpdir}/stretch.ppm

width_height=`pamfile -size testimg.ppm | \
                awk '{print "-width="$1, "-height="$2}'`

pamstretch-gen 3.96 testimg.ppm | pamvalidate > ${stretch_ppm}
echo 3.96 hermite:  
pamscale 3.96 -filter=hermite testimg.ppm | \
  pnmpsnr -target1=38.84 -target2=52 -target3=46.28 - ${stretch_ppm} || \
  echo failure ${PIPESTATUS[@]} ":" $?

pamscale ${width_height} -filter=hermite ${stretch_ppm} | \
  pnmpsnr -target1=43.38 -target2=58.22 -target3=54.36 testimg.ppm - || \
  echo failure ${PIPESTATUS[@]} ":" $?
rm ${stretch_ppm}

pamstretch-gen 2.75 testimg.ppm | pamvalidate > ${stretch_ppm}
echo 2.75 lanczos:  
pamscale 2.75 -filter=lanczos testimg.ppm | \
  pnmpsnr -target1=38.74 -target2=51.91 -target3=46.47 - ${stretch_ppm} || \
  echo failure ${PIPESTATUS[@]} ":" $?

pamscale ${width_height} -filter=lanczos ${stretch_ppm} | \
  pnmpsnr -target1=46.86 -target2=60.27 -target3=57.46 testimg.ppm - || \
  echo failure ${PIPESTATUS[@]} ":" $?
rm ${stretch_ppm}
